---

# tasks file for osp.servers

- name: Copy key to Workstation
  copy:
    src: "{{ osp_keyfilename }}"
    dest: "/tmp/{{ osp_keyfilename }}"

- name: Ensure OSP have proper SSH keys for instances
  os_keypair:
    cloud: "{{ cloud }}"
    state: present
    name: "{{ key_name }}"
    public_key_file: "/tmp/{{ key_filename }}"

- name: Create new server instances and attaches them a network and passes metadata to the instance
  include_tasks: create_osp_servers.yml
  loop: "{{ lookup('dict', osp_servers) }}"
 
- name:  Add floating IP to Servers
  include_tasks: add_fip.yml
  loop: "{{ lookup('dict', osp_servers) }}"

- name: Wait for server to be available
  include_tasks: wait_osp_servers.yml
  loop: "{{ lookup('dict', osp_servers) }}"
